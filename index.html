<html>
	<head>
		<script type="text/javascript" src="./scripts/gl-matrix.js"></script>
		<script type="text/javascript" src="./scripts/utils.js"></script>
		<script type="text/javascript" src="./scripts/KoBuffers/KoBaseBuffer.js"></script>
		<script type="text/javascript" src="./scripts/KoBuffers/KoArrayBuffer.js"></script>
		<script type="text/javascript" src="./scripts/KoBuffers/KoElementArrayBuffer.js"></script>
		<script type="text/javascript" src="./scripts/KoShader.js"></script>
		<script type="text/javascript" src="./scripts/KoShaderProgram.js"></script>
		<script type="text/javascript" src="./scripts/KoModel.js"></script>
		<script type="text/javascript" src="./scripts/KoGL.js"></script>
	</head>
	<body>
		<canvas id="glcanvas" width="640" height="480">
		    Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
		</canvas>

		<script id="shader-fs" type="x-shader/x-fragment">
			varying lowp vec4 vColor;
    	
		    void main(void) {
		    	gl_FragColor = vColor;
		    }
		</script>

		<script id="shader-vs" type="x-shader/x-vertex">
			attribute vec3 aVertexPosition;
			attribute vec4 aVertexColor;
		
			uniform mat4 uMVMatrix;
			uniform mat4 uPMatrix;
			
			varying lowp vec4 vColor;
			
			void main(void) {
				gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
				vColor = aVertexColor;
			}
		</script>

		<script type="text/javascript">
			var canvas = document.getElementById('glcanvas');
			var koGL = new KoGL(canvas);
			koGL.initShaderProgram('shader-fs', 'shader-vs');
			koGL.setCamera();

			function init(data){
				var suzanne = koGL.createModel();
				suzanne.initVerticesBuffer(data.vertices, 3);
				suzanne.initVerticesColorBuffer(data.colors, 4);
				suzanne.initVerticesIndexBuffer(data.indices, 3);

				koGL.addModel(suzanne);
				suzanne.translate([0.0, 0.0, -6.0]);

				setInterval(function(){
					koGL.clearScene();
					koGL.drawScene();

					if(!mouse.down){
						suzanne.rotate(1, [0, 1, 0]);
		            	suzanne.rotate(1, [1, 0, 0]);
					}
				}, 10);

				var mouse = {};
				canvas.addEventListener('mousedown', function(){
					mouse.down = true;
				});

				canvas.addEventListener('mouseup', function(){
					mouse.down = false;
				});

				canvas.addEventListener('mousemove', function(e){
					var x = mouse.x = e.pageX - this.offsetLeft;
	            	var y = mouse.y = e.pageY - this.offsetTop;
	            	var movement = {
	            		x: e.webkitMovementX,
	            		y: e.webkitMovementY
	            	};

	            	if(mouse.down){
		            	suzanne.rotate(movement.x, [0, 1, 0]);
		            	suzanne.rotate(movement.y, [1, 0, 0]);
		            }
				});

				canvas.addEventListener('mousewheel', function(e){
					suzanne.translate([0.0, 0.0, e.deltaY / 100]);
				});
			}
		</script>

		<!-- models -->
		<script type="text/javascript" src="./models/suzanne.js"></script>
	</body>
</html>